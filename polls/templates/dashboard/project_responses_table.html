{% extends "dashboard/base.html" %}

{% block dashboard_title %}–û—Ç–≤–µ—Ç—ã: {{ poll.title }}{% endblock %}

{% block content %}
  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <div class="mb-8">
    <a href="{% url 'polls:project_detail' poll_id=poll.id %}"
       class="inline-flex items-center gap-2 text-sm text-gray-600 hover:text-indigo-600 transition-all duration-300 transform hover:scale-105"
       aria-label="–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –¥–µ—Ç–∞–ª—è–º –æ–ø—Ä–æ—Å–∞">
      <i class="fas fa-arrow-left" aria-hidden="true"></i>
      <span>–ù–∞–∑–∞–¥ –∫ –æ–ø—Ä–æ—Å—É</span>
    </a>
  </div>

  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –¥–µ–π—Å—Ç–≤–∏—è -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-8">
    <div>
      <h1 class="text-3xl font-extrabold text-gray-800">–û—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h1>
      <h2 class="text-lg text-gray-600 mt-1">{{ poll.title }}</h2>
    </div>
    <a href="{% url 'polls:project_stats' poll_id=poll.id %}"
       class="inline-flex items-center gap-3 mt-4 md:mt-0 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-semibold py-3 px-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-110">
      <i class="fas fa-chart-bar" aria-hidden="true"></i>
      <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
    </a>
  </div>

  <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="bg-gradient-to-r from-indigo-500 to-indigo-600 text-white rounded-2xl shadow-xl overflow-hidden mb-10">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 p-8">
      <div class="text-center">
        <div class="text-5xl font-extrabold mb-2">{{ total_submissions }}</div>
        <div class="opacity-90">–í—Å–µ–≥–æ –æ—Ç–ø—Ä–∞–≤–æ–∫</div>
      </div>
      <div class="text-center">
        <div class="text-4xl font-bold mb-2 font-mono">{{ poll.access_code }}</div>
        <div class="opacity-90">–ö–æ–¥ –¥–æ—Å—Ç—É–ø–∞</div>
      </div>
      <div class="text-center">
        <a href="{% url 'polls:poll_public' access_code=poll.access_code %}" target="_blank"
           class="underline opacity-90 hover:opacity-100 transition duration-200">
          –ü—É–±–ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ ‚Üí
        </a>
      </div>
    </div>
  </div>

  <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–µ–∂–∏–º–∞ -->
  {% if has_test_questions %}
    <div class="flex items-start gap-3 p-4 mb-6 text-sm bg-green-50 border border-green-200 rounded-lg text-green-800"
         role="alert" aria-live="polite">
      <i class="fas fa-flask text-green-600 mt-0.5" aria-hidden="true"></i>
      <div>
        <strong class="font-medium">üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º</strong>
        ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã. –ü–æ–∫–∞–∑–∞–Ω—ã –±–∞–ª–ª—ã: 
        <code class="bg-green-100 text-green-900 px-2 py-1 rounded font-mono text-xs">–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ / –≤—Å–µ–≥–æ</code>.
      </div>
    </div>
  {% else %}
    <div class="flex items-start gap-3 p-4 mb-6 text-sm bg-yellow-50 border border-yellow-200 rounded-lg text-yellow-800"
         role="alert" aria-live="polite">
      <i class="fas fa-edit text-yellow-600 mt-0.5" aria-hidden="true"></i>
      <div>
        <strong class="font-medium">üìù –û–±—ã—á–Ω—ã–π –æ–ø—Ä–æ—Å</strong>
        ‚Äî —Å–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏.
      </div>
    </div>
  {% endif %}

 {% if rows %}
  <div class="overflow-x-auto rounded-xl border border-gray-200 shadow-sm bg-white">
    <table class="min-w-full divide-y divide-gray-100">
      <thead>
        <tr class="bg-gray-50 border-b border-gray-200 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">
          <th class="px-4 py-3 w-12">#</th>
          <th class="px-4 py-3">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
          <th class="px-4 py-3">–í—Ä–µ–º—è</th>
          <th class="px-4 py-3">–ë–∞–ª–ª—ã</th>
          {% for question in questions %}
            <th class="px-4 py-3 min-w-48 lg:min-w-64">
              <span class="block truncate max-w-xs cursor-help font-medium text-gray-800"
                    title="{{ question.text }}">
                {{ question.text|truncatewords:6 }}
              </span>
            </th>
          {% endfor %}
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        {% for row in rows %}
          <tr class="hover:bg-gray-50 transition-colors duration-150">
            <td class="px-4 py-3 text-sm text-gray-500 font-medium text-center">{{ forloop.counter }}</td>
            <td class="px-4 py-3 font-medium text-sm">{{ row.username|default:"–ê–Ω–æ–Ω–∏–º" }}</td>
            <td class="px-4 py-3 text-sm text-gray-600">{{ row.created_at|date:"d.m.Y H:i" }}</td>
            <td class="px-4 py-3 font-semibold">
              {% if row.score is not None and row.total is not None %}
                <span style="color: {{ row.score_color }};">{{ row.score }}/{{ row.total }}</span>
              {% else %}
                <span class="text-gray-400">‚Äî</span>
              {% endif %}
            </td>
            {% for cell in row.cells %}
              <td class="px-4 py-3 text-sm text-gray-800 break-words max-w-xs min-w-48 lg:min-w-64">
                {{ cell|safe }}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="flex flex-col items-center justify-center p-10 text-center bg-gray-50 rounded-xl border border-dashed border-gray-300 mt-6">
    <div class="text-6xl mb-4">üì≠</div>
    <h3 class="text-xl font-semibold text-gray-700 mb-2">–ù–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤</h3>
    <p class="text-gray-500 max-w-md">
      {% if poll.questions.exists %}
        –û—Ç–≤–µ—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è.
      {% else %}
        –ù–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤. 
        <a href="{% url 'polls:question_new' poll.id %}" class="text-indigo-600 hover:text-indigo-800 font-medium underline decoration-dotted">
          –î–æ–±–∞–≤—å—Ç–µ –≤–æ–ø—Ä–æ—Å
        </a>.
      {% endif %}
    </p>
  </div>
{% endif %}
{% endblock %}