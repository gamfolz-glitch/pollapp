{% extends "dashboard/base.html" %}

{% block dashboard_title %}–û—Ç–≤–µ—Ç—ã: {{ poll.title }}{% endblock %}

{% block content %}
  <!-- –ù–∞–∑–∞–¥ -->
  <a href="{% url 'polls:project_detail' poll.id %}" class="btn btn-outline" style="margin-bottom: 1rem;">‚Üê –ù–∞–∑–∞–¥ –∫ –æ–ø—Ä–æ—Å—É</a>

  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
  <div class="flex flex-between" style="align-items: start; margin-bottom: 1.5rem;">
    <div>
      <h1 style="margin: 0;">üìã –û—Ç–≤–µ—Ç—ã</h1>
      <p style="color: var(--text-light); margin: 0.5rem 0 0;">{{ poll.title }}</p>
    </div>
    <a href="{% url 'polls:project_stats' poll.id %}" class="btn btn-primary">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
  </div>

  <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–µ–∂–∏–º–∞ -->
  {% if has_test_questions %}
    <div class="info" style="background: #d4edda; color: #155724; padding: 1rem; border-radius: 0.5rem; border-left: 4px solid #c3e6cb; margin-bottom: 1.5rem;">
      <strong>üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º</strong> ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã. –ù–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω—ã –±–∞–ª–ª—ã: <code>–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ / –≤—Å–µ–≥–æ</code>.
    </div>
  {% else %}
    <div class="info" style="background: #fff3cd; color: #856404; padding: 1rem; border-radius: 0.5rem; border-left: 4px solid #ffeaa7; margin-bottom: 1.5rem;">
      <strong>üìù –û–±—ã—á–Ω—ã–π –æ–ø—Ä–æ—Å</strong> ‚Äî —Å–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏. –°—Ç–æ–ª–±–µ—Ü ¬´–ë–∞–ª–ª—ã¬ª –ø—É—Å—Ç.
    </div>
  {% endif %}

  <!-- –¢–∞–±–ª–∏—Ü–∞ -->
  {% if rows %}
    <div class="card" style="overflow: hidden; margin-top: 1rem;">
      <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
              <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #495057;">#</th>
              <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #495057;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
              <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #495057;">–í—Ä–µ–º—è</th>
              <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #495057;">–ë–∞–ª–ª—ã</th>
              {% for q in poll.questions.all %}
                <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #495057; white-space: nowrap;">{{ q.text|truncatewords:6 }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for r in rows %}
              <tr style="border-bottom: 1px solid #e9ecef;">
                <td style="padding: 0.75rem; color: #6c757d; font-weight: 500;">{{ forloop.counter }}</td>
                <td style="padding: 0.75rem;"><strong>{{ r.username }}</strong></td>
                <td style="padding: 0.75rem; color: #6c757d; font-size: 0.9rem;">{{ r.created_at|date:"d.m.Y H:i" }}</td>
                <td style="padding: 0.75rem; font-weight: 600; color: {{ r.score_color }};">
                  {% if r.score is not None and r.total is not None %}
                    {{ r.score }}/{{ r.total }}
                  {% else %}
                    ‚Äî
                  {% endif %}
                </td>
                {% for cell in r.cells %}
                  <td style="padding: 0.75rem; color: #212529;">{{ cell }}</td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% else %}
    <div class="card empty-state" style="text-align: center; padding: 3rem 1rem; margin-top: 1rem;">
      <div style="font-size: 4rem; color: #adb5bd;">üì≠</div>
      <h3 style="margin: 0.75rem 0 0; color: var(--text);">–ù–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤</h3>
      <p style="color: var(--text-light); max-width: 500px; margin: 0 auto;">
        {% if poll.questions.exists %}
          –û—Ç–≤–µ—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è.
        {% else %}
          –ù–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤. <a href="{% url 'polls:question_new' poll.id %}" class="link">–î–æ–±–∞–≤—å—Ç–µ –≤–æ–ø—Ä–æ—Å</a>.
        {% endif %}
      </p>
    </div>
  {% endif %}
{% endblock %}