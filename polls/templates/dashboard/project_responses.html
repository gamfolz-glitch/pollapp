{% extends "dashboard/base.html" %}

{% block dashboard_title %}–û—Ç–≤–µ—Ç—ã: {{ poll.title }}{% endblock %}

{% block content %}
  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <div class="mb-8">
    <a href="{% url 'polls:project_detail' poll_id=poll.id %}"
       class="inline-flex items-center gap-2 text-sm text-gray-600 hover:text-indigo-600 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded"
       aria-label="–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –¥–µ—Ç–∞–ª—è–º –æ–ø—Ä–æ—Å–∞">
      <i class="fas fa-arrow-left" aria-hidden="true"></i>
      <span>–ù–∞–∑–∞–¥ –∫ –æ–ø—Ä–æ—Å—É</span>
    </a>
  </div>

  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –¥–µ–π—Å—Ç–≤–∏—è -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-8 gap-4">
    <div>
      <h1 class="text-3xl font-extrabold text-gray-900">–û—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h1>
      <h2 class="text-lg text-gray-600 mt-1 truncate max-w-full">{{ poll.title }}</h2>
    </div>
    <a href="{% url 'polls:project_stats' poll_id=poll.id %}"
       class="inline-flex items-center gap-3 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white font-semibold py-3 px-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500"
       aria-label="–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –æ–ø—Ä–æ—Å—É">
      <i class="fas fa-chart-bar" aria-hidden="true"></i>
      <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
    </a>
  </div>

  <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="bg-gradient-to-r from-indigo-500 to-indigo-600 text-white rounded-2xl shadow-xl overflow-hidden mb-10">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 p-8">
      <div class="text-center">
        <div class="text-5xl font-extrabold mb-2">{{ total_submissions }}</div>
        <div class="opacity-90">–í—Å–µ–≥–æ –æ—Ç–ø—Ä–∞–≤–æ–∫</div>
      </div>
      <div class="text-center">
        <div class="text-4xl font-bold mb-2 font-mono">{{ poll.access_code }}</div>
        <div class="opacity-90">–ö–æ–¥ –¥–æ—Å—Ç—É–ø–∞</div>
      </div>
      <div class="text-center">
        <a href="{% url 'polls:poll_public' access_code=poll.access_code %}" target="_blank"
           class="underline opacity-90 hover:opacity-100 transition duration-200">
          –ü—É–±–ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ ‚Üí
        </a>
      </div>
    </div>
  </div>

  <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–µ–∂–∏–º–∞ -->
  {% if has_test_questions %}
    <div class="flex items-start gap-3 p-4 mb-6 text-sm bg-green-50 border border-green-200 rounded-lg text-green-800"
         role="status" aria-live="polite">
      <i class="fas fa-flask text-green-600 mt-0.5" aria-hidden="true"></i>
      <div>
        <strong class="font-medium">üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º</strong>
        ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã. –ü–æ–∫–∞–∑–∞–Ω—ã –±–∞–ª–ª—ã: 
        <code class="bg-green-100 px-1.5 py-0.5 rounded font-mono text-sm">–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ / –≤—Å–µ–≥–æ</code>.
      </div>
    </div>
  {% else %}
    <div class="flex items-start gap-3 p-4 mb-6 text-sm bg-yellow-50 border border-yellow-200 rounded-lg text-yellow-800"
         role="status" aria-live="polite">
      <i class="fas fa-edit text-yellow-600 mt-0.5" aria-hidden="true"></i>
      <div>
        <strong class="font-medium">üìù –û–±—ã—á–Ω—ã–π –æ–ø—Ä–æ—Å</strong>
        ‚Äî —Å–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏.
      </div>
    </div>
  {% endif %}

  <!-- –¢–∞–±–ª–∏—Ü–∞ –æ—Ç–≤–µ—Ç–æ–≤ -->
  {% if rows %}
    <div class="overflow-hidden rounded-xl border border-gray-200 shadow-sm bg-white">
      <div class="overflow-x-auto -mx-4 px-4 lg:-mx-6 lg:px-6">
        <table class="w-full border-collapse min-w-full">
          <thead>
            <tr class="border-b border-gray-200 text-left">
              <th scope="col" class="px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider">#</th>
              <th scope="col" class="px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
              <th scope="col" class="px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider">–í—Ä–µ–º—è</th>
              <th scope="col" class="px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider">–ë–∞–ª–ª—ã</th>
              {% for question in questions %}
                <th scope="col" class="px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider whitespace-nowrap">
                  {{ question.text|truncatewords:6 }}
                </th>
              {% endfor %}
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            {% for row in rows %}
              <tr class="hover:bg-gray-50 transition-colors duration-150">
                <td class="px-4 py-3 text-sm text-gray-500 font-medium">{{ forloop.counter }}</td>
                <td class="px-4 py-3 font-medium text-gray-900">{{ row.username|default:"–ê–Ω–æ–Ω–∏–º" }}</td>
                <td class="px-4 py-3 text-sm text-gray-600">{{ row.created_at|date:"d.m.Y H:i" }}</td>
                <td class="px-4 py-3 font-semibold">
                  {% if row.score is not None and row.total is not None %}
                    <span style="color: {{ row.score_color|default:"#000000" }};">
                      {{ row.score }}/{{ row.total }}
                    </span>
                  {% else %}
                    <span class="text-gray-400">‚Äî</span>
                  {% endif %}
                </td>
                {% for cell in row.cells %}
                  <td class="px-4 py-3 text-gray-800 break-words max-w-[150px]">
                    {{ cell|safe }}
                  </td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% else %}
    <div class>
      <div class="text-6xl mb-4" aria-hidden="true">üì≠</div>
      <h3 class="text-xl font-semibold text-gray-800 mb-2">–ù–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤</h3>
      <p class="text-gray-600 max-w-md">
        {% if poll.questions.exists %}
          –û—Ç–≤–µ—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è.
        {% else %}
          –ù–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤. 
          <a href="{% url 'polls:question_new' poll.id %}" 
             class="text-indigo-600 hover:text-indigo-800 font-medium underline hover:no-underline focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded"
             aria-label="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å –∫ –æ–ø—Ä–æ—Å—É">
            –î–æ–±–∞–≤—å—Ç–µ –≤–æ–ø—Ä–æ—Å
          </a>.
        {% endif %}
      </p>
    </div>
  {% endif %}
{% endblock %}
