{% extends "dashboard/base.html" %}

{% block dashboard_title %}{{ poll.title }}{% endblock %}

{% block content %}
<div class="flex" style="gap: 0.5rem; align-items: start; flex-direction: column; margin-bottom: 1rem;">
  <h1 style="margin: 0; font-size: 1.5rem; font-weight: 600;">{{ poll.title }}</h1>
  
  <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
    <a href="/dashboard/project/{{ poll.id }}/edit/" class="btn btn-outline" style="font-size: 0.875rem; padding: 0.5rem 1rem;">
      ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
    </a>
    <a href="/dashboard/project/{{ poll.id }}/delete/" class="btn btn-danger" style="font-size: 0.875rem; padding: 0.5rem 1rem;">
      üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
    </a>
  </div>
</div>

{% if poll.description %}
  <div style="margin: 0 0 1.5rem; color: var(--text-light); line-height: 1.5;">
    {{ poll.description }}
  </div>
{% endif %}

<div style="margin-bottom: 1.5rem;">
  <a href="/dashboard/project/{{ poll.id }}/question/new/" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</a>
</div>

<div class="card">
  <h3 style="margin-bottom: 1rem;">üîó –î–æ—Å—Ç—É–ø –∫ –æ–ø—Ä–æ—Å—É</h3>
  <div class="grid grid-2" style="gap: 1rem; align-items: center;">
    <div>
      <label class="text-muted" style="display: block; margin-bottom: 0.5rem; font-size: 0.875rem;">–ö–æ–¥ –¥–æ—Å—Ç—É–ø–∞</label>
      <code style="font-size: 1.25rem; padding: 0.5rem 1rem; display: inline-block;">{{ poll.access_code }}</code>
    </div>
    <div>
      <label class="text-muted" style="display: block; margin-bottom: 0.5rem; font-size: 0.875rem;">–ü—É–±–ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞</label>
      <a href="/p/{{ poll.access_code }}/" target="_blank" class="btn btn-outline" style="font-size: 0.875rem;">
        /p/{{ poll.access_code }}/
      </a>
    </div>
  </div>

  <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
    <label class="text-muted" style="display: block; margin-bottom: 0.75rem; font-size: 0.875rem;">QR-–∫–æ–¥</label>
    <div class="flex" style="gap: 1.25rem; align-items: center; flex-wrap: wrap;">
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <img
          src="/p/{{ poll.access_code }}/qr.png"
          alt="QR –∫–æ–¥"
          style="border: 2px solid var(--border); border-radius: 0.75rem; padding: 0.75rem; background: white;"
          width="160"
          height="160"
        />
        <div>
          <p class="text-muted" style="margin: 0 0 0.5rem; font-size: 0.9rem;">–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ</p>
          <a href="/p/{{ poll.access_code }}/qr/" target="_blank" class="btn btn-outline" style="display: inline-flex; align-items: center; gap: 0.35rem; font-size: 0.95rem;">
            üì± –û—Ç–∫—Ä—ã—Ç—å QR-—Å—Ç—Ä–∞–Ω–∏—Ü—É
          </a>
        </div>
      </div>
    </div>
  </div>

  <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
    <div class="flex" style="gap: 1rem; flex-wrap: wrap;">
      <a href="/dashboard/project/{{ poll.id }}/stats/" class="btn btn-success">
        üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
      </a>
      <a href="/dashboard/project/{{ poll.id }}/responses/" class="btn btn-outline">
        –û—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      </a>
    </div>
  </div>
</div>

<h2 style="margin-top: 2rem; margin-bottom: 1rem;">‚ùì –í–æ–ø—Ä–æ—Å—ã –æ–ø—Ä–æ—Å–∞</h2>

{% if questions %}
  <div class="grid">
    {% for q in questions %}
      <div class="card">
        <div class="flex flex-between" style="margin-bottom: 0.75rem;">
          <div>
            <span class="badge {% if q.kind == 'TEXT' %}badge-primary{% elif q.kind == 'SINGLE' %}badge-success{% else %}badge-warning{% endif %}" style="margin-right: 0.5rem;">
              {% if q.kind == 'TEXT' %}üìù –¢–µ–∫—Å—Ç
              {% elif q.kind == 'SINGLE' %}üîò –û–¥–∏–Ω–æ—á–Ω—ã–π –≤—ã–±–æ—Ä
              {% else %}‚òëÔ∏è –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä
              {% endif %}
            </span>
            <strong style="font-size: 1.125rem;">–í–æ–ø—Ä–æ—Å #{{ forloop.counter }}</strong>
          </div>
          <div class="flex" style="gap: 0.5rem;">
            <a href="/dashboard/project/{{ poll.id }}/question/{{ q.id }}/edit/" class="btn btn-outline" style="font-size: 0.875rem; padding: 0.5rem 1rem;">
              ‚úèÔ∏è
            </a>
            <a href="/dashboard/project/{{ poll.id }}/question/{{ q.id }}/delete/" class="btn btn-danger" style="font-size: 0.875rem; padding: 0.5rem 1rem;">
              üóëÔ∏è
            </a>
          </div>
        </div>
        
        <p style="font-size: 1.125rem; margin-bottom: 1rem;">{{ q.text }}</p>

        {% if q.kind != 'TEXT' %}
          <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
            <div class="flex flex-between" style="margin-bottom: 0.75rem;">
              <strong>–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞:</strong>
              <a href="/dashboard/project/{{ poll.id }}/question/{{ q.id }}/choice/new/" class="btn btn-outline" style="font-size: 0.875rem; padding: 0.5rem 1rem;">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç
              </a>
            </div>
            
            {% if q.choices.exists %}
              <ul class="list">
                {% for c in q.choices.all %}
                  <li class="list-item" style="padding: 0.75rem; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center;">
                    <span>
                      <span style="color: var(--primary); font-weight: 600; margin-right: 0.5rem;">{{ forloop.counter }}.</span>
                      {{ c.text }}
                    </span>
                    <div class="flex" style="gap: 0.5rem;">
                      <a href="/dashboard/project/{{ poll.id }}/question/{{ q.id }}/choice/{{ c.id }}/edit/" class="btn btn-outline" style="font-size: 0.75rem; padding: 0.25rem 0.75rem;">
                        ‚úèÔ∏è
                      </a>
                      <a href="/dashboard/project/{{ poll.id }}/question/{{ q.id }}/choice/{{ c.id }}/delete/" class="btn btn-danger" style="font-size: 0.75rem; padding: 0.25rem 0.75rem;">
                        üóëÔ∏è
                      </a>
                    </div>
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <p class="text-muted" style="padding: 1rem; background: var(--bg); border-radius: 0.5rem;">
                –ü–æ–∫–∞ –Ω–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥–ª–∏ –≤—ã–±—Ä–∞—Ç—å –æ—Ç–≤–µ—Ç.
              </p>
            {% endif %}
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="card empty-state">
    <div style="font-size: 3rem; margin-bottom: 1rem;">‚ùì</div>
    <h3>–ü–æ–∫–∞ –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤</h3>
    <p style="margin: 1rem 0 1.5rem; color: var(--text-light);">
      –î–æ–±–∞–≤—å—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –∫ –≤–∞—à–µ–º—É –æ–ø—Ä–æ—Å—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–æ–±–∏—Ä–∞—Ç—å –æ—Ç–≤–µ—Ç—ã.
    </p>
    <a href="/dashboard/project/{{ poll.id }}/question/new/" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å</a>
  </div>
{% endif %}
{% endblock %}