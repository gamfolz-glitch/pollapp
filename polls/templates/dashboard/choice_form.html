{% extends "dashboard/base.html" %}

{% block dashboard_title %}{{ title }}{% endblock %}

{% block dashboard_content %}
  <div class="max-w-2xl mx-auto animate-fade-in">
    <!-- Back Button -->
    <a href="{% url 'polls:project_detail' poll_id=poll.id %}" 
       class="text-indigo-600 hover:text-indigo-700 mb-6 inline-flex items-center gap-2 transition-colors">
      <i class="fas fa-arrow-left"></i>
      <span>–ù–∞–∑–∞–¥ –∫ –æ–ø—Ä–æ—Å—É</span>
    </a>

    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold gradient-text mb-2">{{ title }}</h1>
    </div>

    <!-- Question Info -->
    <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-2xl p-6 mb-6 border border-indigo-100">
      <h3 class="font-bold text-gray-800 mb-2 flex items-center gap-2">
        <i class="fas fa-question-circle text-indigo-600"></i>
        <span>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–æ–ø—Ä–æ—Å–µ</span>
      </h3>
      <p class="text-gray-700 mb-2"><strong>–í–æ–ø—Ä–æ—Å:</strong> {{ question.text }}</p>
      <p>
        <strong>–¢–∏–ø:</strong> 
        <span class="inline-flex items-center gap-1 px-3 py-1 rounded-lg text-xs font-bold
          {% if question.kind == 'SINGLE' %}bg-emerald-100 text-emerald-700
          {% else %}bg-amber-100 text-amber-700
          {% endif %}">
          {% if question.kind == 'SINGLE' %}
            <i class="fas fa-circle"></i> –û–¥–∏–Ω –≤—ã–±–æ—Ä
          {% else %}
            <i class="fas fa-check-square"></i> –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä
          {% endif %}
        </span>
      </p>
    </div>

    <!-- Info Alert -->
    {% if question.is_test_question %}
      <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 rounded-lg mb-6">
        <strong class="text-emerald-800">üß™ –¢–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å</strong> ‚Äî –º–æ–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å <em>–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</em>.
      </div>
    {% else %}
      <div class="bg-amber-50 border-l-4 border-amber-500 p-4 rounded-lg mb-6">
        <strong class="text-amber-800">üìå –û–±—ã—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å</strong> ‚Äî –Ω–µ–ª—å–∑—è –æ—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.
      </div>
    {% endif %}

    <!-- Form -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-8 card-hover">
      <form method="post">
        {% csrf_token %}

        {% if form.errors %}
          <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-lg mb-6">
            <strong class="text-red-800 block mb-2">–ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏:</strong>
            <ul class="text-red-700 text-sm space-y-1">
              {% for field in form %}
                {% for error in field.errors %}
                  <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                {% endfor %}
              {% endfor %}
            </ul>
          </div>
        {% endif %}

        <!-- Choice Text -->
        <div class="mb-6">
          <label for="{{ form.text.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
            –¢–µ–∫—Å—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞ *
          </label>
          <input 
            type="text" 
            name="text" 
            id="{{ form.text.id_for_label }}"
            value="{{ form.text.value|default:'' }}"
            required
            class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-200 transition-all input-focus"
            placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞"
          />
          {% if form.text.errors %}
            <p class="text-red-600 text-sm mt-2">{{ form.text.errors|first }}</p>
          {% endif %}
        </div>

        <!-- Is Correct -->
        {% if question.is_test_question %}
          <div class="mb-8">
            <label class="flex items-start gap-3 cursor-pointer">
              <input 
                type="checkbox" 
                name="is_correct" 
                id="id_is_correct"
                {% if form.is_correct.value %}checked{% endif %}
                {% if question.kind == "SINGLE" %}data-single-choice="true"{% endif %}
                class="mt-1 w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"
              />
              <div>
                <span class="block text-sm font-semibold text-gray-700 mb-1">
                  ‚úÖ –≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
                </span>
                <span class="text-xs text-gray-500">
                  –û—Ç–º–µ—Ç—å—Ç–µ, –µ—Å–ª–∏ —ç—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å.
                </span>
              </div>
            </label>

            {% if question.kind == "SINGLE" %}
              <div id="single-warning" class="hidden mt-3 p-3 bg-red-50 border-l-4 border-red-500 rounded-lg text-sm text-red-700">
                ‚ùó –í –≤–æ–ø—Ä–æ—Å–µ —Å –æ–¥–∏–Ω–æ—á–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –º–æ–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ <strong>–æ–¥–∏–Ω</strong> –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.
              </div>
            {% endif %}

            {% if form.is_correct.errors %}
              <p class="text-red-600 text-sm mt-2">{{ form.is_correct.errors|first }}</p>
            {% endif %}
          </div>
        {% else %}
          <input type="hidden" name="is_correct" value="" />
        {% endif %}

        <!-- Buttons -->
        <div class="flex gap-4 justify-center">
          <button type="submit" class="btn-gradient text-white px-8 py-3 rounded-xl font-semibold flex items-center gap-2 shadow-lg group">
            <i class="fas fa-save group-hover:scale-110 transition-transform"></i>
            <span>{% if choice %}–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è{% else %}–î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç{% endif %}</span>
          </button>
          <a href="{% url 'polls:project_detail' poll_id=poll.id %}" 
             class="bg-white border-2 border-gray-300 text-gray-700 px-8 py-3 rounded-xl hover:border-gray-400 transition-all font-semibold">
            –û—Ç–º–µ–Ω–∞
          </a>
        </div>
      </form>
    </div>
  </div>

  {% if question.kind == "SINGLE" and question.is_test_question %}
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const checkbox = document.getElementById('id_is_correct');
        const warning = document.getElementById('single-warning');

        if (!checkbox || !warning) return;

        checkbox.addEventListener('change', function() {
          if (this.checked) {
            // Note: This would require an API endpoint to check correct choices count
            // For now, we'll just show the warning
            warning.classList.remove('hidden');
          } else {
            warning.classList.add('hidden');
          }
        });
      });
    </script>
  {% endif %}
{% endblock %}